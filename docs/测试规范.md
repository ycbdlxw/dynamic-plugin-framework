# 测试规范

## 1. 测试原则

根据系统核心哲学中的"测试驱动开发"原则，所有功能优化、调整或新增都必须有相应的测试用例。本文档规定了项目中测试的编写和执行标准。

## 2. 测试类型

项目中包含以下几种测试类型：

### 2.1 API测试

使用curl命令测试REST API接口，验证接口的正确性、安全性和性能。

### 2.2 功能测试

通过脚本方式测试系统功能模块，验证各个组件的功能正确性。

### 2.3 集成测试

测试多个组件之间的交互，验证系统作为一个整体的功能正确性。

### 2.4 性能测试

使用脚本工具测试系统在高负载下的性能表现。

## 3. 测试文件组织

测试文件应按以下方式组织：

```
src/main/resources/test/           # 测试资源目录
├── runs/                          # 测试执行脚本
│   ├── run_common_api_test.sh     # 执行CommonController API测试的脚本
│   └── ...
├── test_common_api.curl           # CommonController API测试用例
├── test_user_crud.curl            # 用户CRUD测试用例
└── ...
```

## 4. 测试文件编写规范

### 4.1 curl测试文件

curl测试文件必须遵循以下格式规范：

1. 每行必须以`echo`、`#`或`curl`开头
2. 所有命令必须是单行格式，不允许使用反斜杠`\`换行
3. 文件头部使用`#`注释说明测试目的和使用方法
4. 每个测试用例前使用`#`注释说明测试内容
5. 使用`echo`命令输出测试步骤信息
6. 使用`curl`命令执行API请求

示例：

```
# 用户API测试文件
# 使用方法: sh run_user_api_test.sh
# 1. 用户登录测试
echo "执行用户登录测试..."
curl -X POST "http://localhost:8080/api/core/login" -H "Content-Type: application/json" -d '{"username":"admin","password":"password"}' -w "\n\nStatus: %{http_code}\nTime: %{time_total}s\n\n"
```

### 4.2 测试执行脚本

测试执行脚本应包含以下内容：

1. 脚本头部注释，说明脚本用途
2. 设置测试环境变量
3. 执行测试并捕获结果
4. 分析测试结果并输出测试通过/失败信息
5. 将测试结果保存到文件中

## 5. 测试执行

### 5.1 本地测试执行

在本地环境执行测试：

```bash
# 进入测试目录
cd src/main/resources/test/runs

# 执行测试脚本
sh run_common_api_test.sh
```

### 5.2 CI/CD环境测试执行

在CI/CD环境中，测试应作为构建流程的一部分自动执行。

## 6. 测试结果分析

测试结果将保存在`test_results`目录中，格式为`YYYYMMDD_HHMMSS_result.txt`。

测试结果文件包含以下内容：

1. 测试执行时间
2. 每个测试用例的请求和响应
3. 测试通过/失败状态

## 7. 测试覆盖率要求

项目测试覆盖率要求：

- API测试：所有公开API端点必须有测试用例
- 功能测试：所有核心业务功能必须有测试用例
- 集成测试：主要业务流程必须有端到端测试

## 8. 测试维护

随着代码的变更，测试用例也需要相应更新：

1. 当API接口变更时，相应的curl测试文件必须更新
2. 当业务逻辑变更时，相应的功能测试脚本必须更新
3. 当系统架构变更时，相应的集成测试必须更新

## 9. 测试最佳实践

1. 测试应该是可重复的，多次执行应产生相同的结果
2. 测试应该是独立的，不依赖于其他测试的执行顺序
3. 测试应该是自动化的，不需要人工干预
4. 测试应该是全面的，覆盖正常流程、边界条件和异常情况 